[gd_scene load_steps=26 format=3 uid="uid://32gl4r1eefhu"]

[ext_resource type="Script" uid="uid://bhexx6mj1xv3q" path="res://addons/phantom_camera/scripts/phantom_camera/phantom_camera_2d.gd" id="1_dqkch"]
[ext_resource type="PackedScene" uid="uid://dkr80d2pi0d41" path="res://addons/guide/debugger/guide_debugger.tscn" id="2_7thud"]
[ext_resource type="Resource" uid="uid://csbmlpvj6i1xv" path="res://components/guide/contexts/game/move.tres" id="2_qfm1y"]
[ext_resource type="Texture2D" uid="uid://4ct2dpo3bfs3" path="res://assets/sprites/geosprites.png" id="2_qhqgy"]
[ext_resource type="Resource" uid="uid://euybd2w0bax" path="res://addons/phantom_camera/examples/resources/tween/player_phantom_camera_2d_tween.tres" id="2_qlg0r"]
[ext_resource type="PackedScene" uid="uid://bcwkugn6v3oy7" path="res://addons/godot_state_charts/utilities/state_chart_debugger.tscn" id="2_y4r1p"]
[ext_resource type="Resource" uid="uid://cqfhkkleeethw" path="res://components/guide/contexts/game/capture.tres" id="3_fulsm"]
[ext_resource type="Script" uid="uid://stmokg8b8ysy" path="res://entities/player/player.gd" id="3_qlg0r"]
[ext_resource type="Script" uid="uid://hwhqo6u7bssf" path="res://components/input_move_component.gd" id="5_eyb6c"]
[ext_resource type="PackedScene" uid="uid://ucms7gv5yqle" path="res://components/capture.tscn" id="6_3v2ag"]
[ext_resource type="Script" uid="uid://bmucxhobuv3i" path="res://addons/godot_state_charts/state_chart.gd" id="6_tuyoq"]
[ext_resource type="Script" uid="uid://jdqq8gw24d5i" path="res://addons/godot_state_charts/compound_state.gd" id="7_smehm"]
[ext_resource type="PackedScene" uid="uid://bth872ij6mkpc" path="res://components/grid_move_component.tscn" id="8_3wlsy"]
[ext_resource type="Script" uid="uid://dcu2i8t8kecjt" path="res://addons/godot_state_charts/atomic_state.gd" id="8_ur7pv"]
[ext_resource type="Script" uid="uid://btbuih6emodp4" path="res://addons/godot_state_charts/transition.gd" id="9_ur7pv"]
[ext_resource type="Script" uid="uid://ckolnjvgnona7" path="res://addons/godot_state_charts/parallel_state.gd" id="10_oprun"]
[ext_resource type="Script" uid="uid://cn2gbprltpaug" path="res://components/raycasts.gd" id="15_oprun"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_yqrof"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_3wlsy"]
bg_color = Color(0.141176, 0.388235, 0.690196, 1)

[sub_resource type="AtlasTexture" id="AtlasTexture_wvtmh"]
atlas = ExtResource("2_qhqgy")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_7thud"]
atlas = ExtResource("2_qhqgy")
region = Rect2(99, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_a1qjk"]
atlas = ExtResource("2_qhqgy")
region = Rect2(132, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_j3ovn"]
atlas = ExtResource("2_qhqgy")
region = Rect2(66, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_afbqv"]
atlas = ExtResource("2_qhqgy")
region = Rect2(33, 0, 32, 32)

[sub_resource type="SpriteFrames" id="SpriteFrames_gx6sm"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_wvtmh")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_7thud")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wvtmh")
}],
"loop": true,
"name": &"move_down",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_a1qjk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wvtmh")
}],
"loop": true,
"name": &"move_left",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_j3ovn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wvtmh")
}],
"loop": true,
"name": &"move_right",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_afbqv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wvtmh")
}],
"loop": true,
"name": &"move_up",
"speed": 5.0
}]

[node name="Player" type="Node2D"]
script = ExtResource("3_qlg0r")

[node name="DebugLayer" type="CanvasLayer" parent="."]

[node name="StateChartDebugger" parent="DebugLayer" instance=ExtResource("2_y4r1p")]
offset_right = -741.0
offset_bottom = -349.0
initial_node_to_watch = NodePath("../../StateChart")

[node name="GuideDebugger" parent="DebugLayer" instance=ExtResource("2_7thud")]
visible = false

[node name="PanelContainer" type="PanelContainer" parent="DebugLayer"]
offset_left = 832.0
offset_top = 27.0
offset_right = 1128.0
offset_bottom = 175.0

[node name="GridContainer" type="GridContainer" parent="DebugLayer/PanelContainer"]
layout_mode = 2
columns = 2

[node name="DirectionLabel" type="Label" parent="DebugLayer/PanelContainer/GridContainer"]
layout_mode = 2
text = "Direction:"
horizontal_alignment = 2

[node name="DirectionValue" type="Label" parent="DebugLayer/PanelContainer/GridContainer"]
unique_name_in_owner = true
layout_mode = 2
text = "0,0"

[node name="InputMoveComponent" type="Node" parent="." node_paths=PackedStringArray("state_chart")]
script = ExtResource("5_eyb6c")
move_action = ExtResource("2_qfm1y")
state_chart = NodePath("../StateChart")
metadata/_custom_type_script = "uid://hwhqo6u7bssf"

[node name="CaptureComponent" parent="." node_paths=PackedStringArray("progress_bar", "state_chart", "actor") instance=ExtResource("6_3v2ag")]
progress_bar = NodePath("../VisualAnchor/ProgressBar")
capture_action = ExtResource("3_fulsm")
state_chart = NodePath("../StateChart")
actor = NodePath("..")

[node name="GridMoveComponent" parent="." node_paths=PackedStringArray("actor", "ray_casts", "visual_anchor", "state_chart") instance=ExtResource("8_3wlsy")]
actor = NodePath("..")
ray_casts = NodePath("../VisualAnchor/AnimatedSprite2D/RayCasts")
visual_anchor = NodePath("../VisualAnchor")
state_chart = NodePath("../StateChart")
speed = 100.0

[node name="VisualAnchor" type="Marker2D" parent="."]

[node name="ProgressBar" type="ProgressBar" parent="VisualAnchor"]
anchors_preset = 4
anchor_top = 0.5
anchor_bottom = 0.5
offset_left = -12.0
offset_top = -22.0
offset_right = 12.0
offset_bottom = -18.0
grow_vertical = 2
theme_override_styles/background = SubResource("StyleBoxFlat_yqrof")
theme_override_styles/fill = SubResource("StyleBoxFlat_3wlsy")
show_percentage = false
metadata/_edit_use_anchors_ = true

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="VisualAnchor"]
sprite_frames = SubResource("SpriteFrames_gx6sm")
animation = &"move_down"
autoplay = "idle"

[node name="RayCasts" type="Node2D" parent="VisualAnchor/AnimatedSprite2D"]
unique_name_in_owner = true
script = ExtResource("15_oprun")

[node name="BLRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(-9, 0)
target_position = Vector2(0, 32)
collide_with_areas = true
collide_with_bodies = false

[node name="BRRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(9, 0)
target_position = Vector2(0, 32)
collide_with_areas = true
collide_with_bodies = false

[node name="TLRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(-9, 0)
target_position = Vector2(0, -32)
collide_with_areas = true
collide_with_bodies = false

[node name="TRRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(9, 0)
target_position = Vector2(0, -32)
collide_with_areas = true
collide_with_bodies = false

[node name="LTRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(0, -9)
target_position = Vector2(-32, 0)
collide_with_areas = true
collide_with_bodies = false

[node name="LBRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(0, 9)
target_position = Vector2(-32, 0)
collide_with_areas = true
collide_with_bodies = false

[node name="RTRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(0, -9)
target_position = Vector2(32, 0)
collide_with_areas = true
collide_with_bodies = false

[node name="RBRayCast" type="RayCast2D" parent="VisualAnchor/AnimatedSprite2D/RayCasts"]
position = Vector2(0, 9)
target_position = Vector2(32, 0)
collide_with_areas = true
collide_with_bodies = false

[node name="StateChart" type="Node" parent="."]
script = ExtResource("6_tuyoq")
metadata/_custom_type_script = "uid://bmucxhobuv3i"

[node name="ParallelState" type="Node" parent="StateChart"]
script = ExtResource("10_oprun")
metadata/_custom_type_script = "uid://ckolnjvgnona7"

[node name="Move" type="Node" parent="StateChart/ParallelState"]
script = ExtResource("7_smehm")
initial_state = NodePath("CanMove")
metadata/_custom_type_script = "uid://jdqq8gw24d5i"

[node name="CanMove" type="Node" parent="StateChart/ParallelState/Move"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnInputDirection" type="Node" parent="StateChart/ParallelState/Move/CanMove"]
script = ExtResource("9_ur7pv")
to = NodePath("../../TryMoving")
event = &"input_direction"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="OnPreventMove" type="Node" parent="StateChart/ParallelState/Move/CanMove"]
script = ExtResource("9_ur7pv")
to = NodePath("../../CannotMove")
event = &"prevent_move"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="TryMoving" type="Node" parent="StateChart/ParallelState/Move"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnMove" type="Node" parent="StateChart/ParallelState/Move/TryMoving"]
script = ExtResource("9_ur7pv")
to = NodePath("../../Moving")
event = &"move"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="Moving" type="Node" parent="StateChart/ParallelState/Move"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnStopMove" type="Node" parent="StateChart/ParallelState/Move/Moving"]
script = ExtResource("9_ur7pv")
to = NodePath("../../CanMove")
event = &"stop_move"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="CannotMove" type="Node" parent="StateChart/ParallelState/Move"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnAllowMove" type="Node" parent="StateChart/ParallelState/Move/CannotMove"]
script = ExtResource("9_ur7pv")
to = NodePath("../../CanMove")
event = &"allow_move"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="Capture" type="Node" parent="StateChart/ParallelState"]
script = ExtResource("7_smehm")
initial_state = NodePath("CanCapture")
metadata/_custom_type_script = "uid://jdqq8gw24d5i"

[node name="CanCapture" type="Node" parent="StateChart/ParallelState/Capture"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnCapture" type="Node" parent="StateChart/ParallelState/Capture/CanCapture"]
script = ExtResource("9_ur7pv")
to = NodePath("../../Capturing")
event = &"capture"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="Capturing" type="Node" parent="StateChart/ParallelState/Capture"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="OnStopCapture" type="Node" parent="StateChart/ParallelState/Capture/Capturing"]
script = ExtResource("9_ur7pv")
to = NodePath("../../CanCapture")
event = &"stop_capture"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="OnFinishedCapture" type="Node" parent="StateChart/ParallelState/Capture/Capturing"]
script = ExtResource("9_ur7pv")
to = NodePath("../../SuccessfulCapture")
event = &"finished_capture"
delay_in_seconds = "0.0"
metadata/_custom_type_script = "uid://btbuih6emodp4"

[node name="SuccessfulCapture" type="Node" parent="StateChart/ParallelState/Capture"]
script = ExtResource("8_ur7pv")
metadata/_custom_type_script = "uid://dcu2i8t8kecjt"

[node name="PhantomCamera2D" type="Node2D" parent="." node_paths=PackedStringArray("follow_target")]
unique_name_in_owner = true
top_level = true
script = ExtResource("1_dqkch")
priority = 5
follow_mode = 2
follow_target = NodePath("../VisualAnchor/AnimatedSprite2D")
zoom = Vector2(2, 2)
tween_resource = ExtResource("2_qlg0r")
inactive_update_mode = 1
follow_damping = true
dead_zone_width = 0.25
dead_zone_height = 0.25
show_viewfinder_in_play = true
draw_limits = true
limit_left = -128
limit_top = -128
limit_right = 1152
limit_bottom = 1152
metadata/_custom_type_script = "uid://bhexx6mj1xv3q"

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]

[connection signal="state_processing" from="StateChart/ParallelState/Move/TryMoving" to="GridMoveComponent" method="try_moving"]
[connection signal="state_processing" from="StateChart/ParallelState/Move/Moving" to="GridMoveComponent" method="moving"]
[connection signal="state_entered" from="StateChart/ParallelState/Capture/Capturing" to="CaptureComponent" method="_on_capturing_state_entered"]
[connection signal="state_exited" from="StateChart/ParallelState/Capture/Capturing" to="CaptureComponent" method="_on_capturing_state_exited"]
[connection signal="state_processing" from="StateChart/ParallelState/Capture/Capturing" to="CaptureComponent" method="capture"]
[connection signal="state_entered" from="StateChart/ParallelState/Capture/SuccessfulCapture" to="CaptureComponent" method="_on_successful_capture_state_entered"]
